<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAID LLC - Real-Time OpenClaw Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #bdc3c7;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #2ecc71;
        }
        
        .connection-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #2ecc71;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, #3498db, #2ecc71);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .card h2 {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2ecc71;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .card-label {
            color: #bdc3c7;
            font-size: 0.9rem;
        }
        
        .card-footer {
            margin-top: 10px;
            font-size: 0.8rem;
            color: #95a5a6;
            text-align: right;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .status-title {
            color: #3498db;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .status-items {
            list-style: none;
        }
        
        .status-item {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-value {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .activity-feed {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .activity-feed h2 {
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .activity-item {
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .activity-title {
            font-weight: bold;
            color: #3498db;
        }
        
        .activity-time {
            color: #bdc3c7;
            font-size: 0.8rem;
        }
        
        .activity-description {
            color: #ecf0f1;
            font-size: 0.9rem;
            line-height: 1.5;
            padding: 8px 0 0 0;
        }
        
        .activity-explanation {
            margin-top: 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid #3498db;
            border-radius: 0 4px 4px 0;
            font-size: 0.85rem;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .log-timestamp {
            color: #3498db;
            min-width: 150px;
            font-weight: bold;
        }
        
        .log-content {
            flex: 1;
            word-break: break-word;
        }
        
        .log-runtime {
            color: #2ecc71;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .log-tokens {
            color: #f39c12;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .control-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: rgba(52, 152, 219, 0.2);
            color: white;
            border: 1px solid #3498db;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .control-btn:hover:not(:disabled) {
            background: rgba(52, 152, 219, 0.4);
        }
        
        .control-btn.active {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .refresh-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(to right, #3498db, #2ecc71);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: opacity 0.3s ease;
            position: relative;
        }
        
        .refresh-btn:hover:not(:disabled) {
            opacity: 0.9;
        }
        
        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .refresh-spinner {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
        }
        
        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
            color: #bdc3c7;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .system-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .status-active {
            background: rgba(46, 204, 113, 0.2);
            color: #2ecc71;
        }
        
        .status-inactive {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #3498db, #2ecc71);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2ecc71;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-top: 5px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            display: none;
        }
        
        .api-status {
            font-size: 0.8rem;
            color: #bdc3c7;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PAID LLC - Real-Time OpenClaw Dashboard</h1>
            <p class="subtitle">Live monitoring and activity tracking for your AI development environment</p>
            <div class="status-bar">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>System Status: <strong id="systemStatusLabel">Loading...</strong></span>
                </div>
                <div class="connection-status">
                    <div class="connection-dot" id="apiConnectionDot"></div>
                    <span>API: <span id="apiStatusText">Connecting...</span></span>
                </div>
                <div class="last-updated">
                    Last Updated: <span id="lastUpdated">--:--:--</span>
                </div>
            </div>
        </header>
        
        <div class="error-message" id="errorMessage"></div>
        
        <div class="dashboard-grid">
            <div class="card">
                <h2>System Status</h2>
                <div class="card-value" id="systemStatus">Loading...</div>
                <div class="card-label">Current system status</div>
                <div class="card-footer">Updated: <span id="statusUpdated">--:--:--</span></div>
            </div>
            
            <div class="card">
                <h2>Version</h2>
                <div class="card-value" id="versionValue">Loading...</div>
                <div class="card-label">OpenClaw release</div>
                <div class="card-footer">Updated: <span id="versionUpdated">--:--:--</span></div>
            </div>
            
            <div class="card">
                <h2>Active Sessions</h2>
                <div class="card-value" id="activeSessions">Loading...</div>
                <div class="card-label">Currently running</div>
                <div class="card-footer">Updated: <span id="sessionsUpdated">--:--:--</span></div>
            </div>
            
            <div class="card">
                <h2>Tokens Processed</h2>
                <div class="card-value" id="tokensProcessed">Loading...</div>
                <div class="card-label">In: <span id="tokensIn">0</span> | Out: <span id="tokensOut">0</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="tokensProgress" style="width: 0%"></div>
                </div>
                <div class="card-footer">Updated: <span id="tokensUpdated">--:--:--</span></div>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgResponse">0ms</div>
                <div class="stat-label">Avg Response</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="memoryUsage">0%</div>
                <div class="stat-label">Memory</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="cpuUsage">0%</div>
                <div class="stat-label">CPU</div>
            </div>
        </div>
        
        <div class="status-grid">
            <div class="status-card">
                <h2 class="status-title">Session Details</h2>
                <ul class="status-items">
                    <li class="status-item">
                        <span>Session ID:</span>
                        <span class="status-value" id="sessionId">Loading...</span>
                    </li>
                    <li class="status-item">
                        <span>Model:</span>
                        <span class="status-value" id="modelUsed">Loading...</span>
                    </li>
                    <li class="status-item">
                        <span>Context Usage:</span>
                        <span class="status-value" id="contextUsage">Loading...</span>
                    </li>
                    <li class="status-item">
                        <span>Runtime:</span>
                        <span class="status-value" id="runtimeEnv">Loading...</span>
                    </li>
                    <li class="status-item">
                        <span>Thinking:</span>
                        <span class="status-value" id="thinkingMode">Loading...</span>
                    </li>
                </ul>
            </div>
            
            <div class="status-card">
                <h2 class="status-title">Recent Activities <span id="activityCountBadge" class="notification-badge" style="position: static; display: inline-block; width: auto; height: auto; background: none; font-size: 0.8em;">(0)</span></h2>
                <ul class="status-items" id="recentActivities">
                    <li class="status-item"><span>Loading recent activities...</span><span class="status-value"><div class="loading"></div></span></li>
                </ul>
            </div>
        </div>
        
        <div class="status-card">
            <h2 class="status-title">System Health <span class="system-status status-active" id="healthStatus">ACTIVE</span></h2>
            <div style="padding: 15px 0;">
                <p>Gateway: <span class="status-value" id="gatewayStatus">Loading...</span> | Agents: <span class="status-value" id="agentsStatus">Loading...</span> | Tools: <span class="status-value" id="toolsStatus">Loading...</span></p>
                <p>Memory: <span class="status-value" id="memoryStatus">Loading...</span> | CPU: <span class="status-value" id="cpuStatus">Loading...</span> | Storage: <span class="status-value" id="storageStatus">Loading...</span></p>
            </div>
        </div>
        
        <div class="controls">
            <button class="control-btn active" onclick="showTab('activities')" id="activitiesBtn">Activities</button>
            <button class="control-btn" onclick="showTab('detailed')" id="detailedBtn">Detailed View</button>
            <button class="control-btn" onclick="showTab('logs')" id="logsBtn">Live Log</button>
            <button class="control-btn" onclick="toggleAutoRefresh()" id="refreshToggle">Auto-Refresh: ON</button>
            <button class="control-btn" onclick="forceRefresh()" id="forceRefreshBtn">Force Refresh</button>
            <button class="control-btn" onclick="toggleTheme()" id="themeToggle">Theme: Light</button>
        </div>
        
        <div id="activities-tab" class="tab-content active">
            <div class="activity-feed">
                <h2>Recent Activity Feed <span id="activityCount">(0)</span></h2>
                <div id="activityList">
                    <div class="activity-item">
                        <div class="activity-header">
                            <span class="activity-title">Loading activities...</span>
                            <span class="activity-time">--:--:--</span>
                        </div>
                        <div class="activity-description">
                            <div class="loading"></div> Fetching real-time activity data from OpenClaw...
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="detailed-tab" class="tab-content">
            <div class="activity-feed">
                <h2>Recent Activity Feed - Detailed View <span id="detailedActivityCount">(0)</span></h2>
                <div id="detailedActivityList">
                    <div class="activity-item">
                        <div class="activity-header">
                            <span class="activity-title">Loading activities...</span>
                            <span class="activity-time">--:--:--</span>
                        </div>
                        <div class="activity-description">
                            <div class="loading"></div> Fetching detailed activity data from OpenClaw...
                        </div>
                        <div class="activity-explanation">
                            <strong>Explanation:</strong> This section will display detailed explanations of each activity as they occur in real-time.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="logs-tab" class="tab-content">
            <h2>Live System Log <span id="logCount">(0)</span></h2>
            <div class="log-container" id="logContainer">
                <div class="log-entry">
                    <span class="log-timestamp">[--:--:--]</span>
                    <div class="log-content">
                        <span class="log-runtime">RUNTIME:</span> <div class="loading"></div> Connecting to OpenClaw log stream...
                        <span class="log-tokens">TOKENS:</span> --, --
                    </div>
                </div>
            </div>
        </div>
        
        <button class="refresh-btn" onclick="forceRefresh()" id="floatingRefresh">
            <span class="refresh-spinner" id="refreshSpinner">‚è≥</span>
            <span id="refreshText">Refresh Dashboard</span>
        </button>
        
        <footer>
            <p>PAID LLC - Performance Artificial Intelligence Development Dashboard</p>
            <p>Real-time monitoring for your OpenClaw instance | Last updated: <span id="currentTime">Loading...</span></p>
            <p>Connected to OpenClaw Gateway | Refresh interval: <span id="refreshInterval">15</span>s | Next refresh: <span id="nextRefresh">--:--:--</span></p>
            <p class="api-status">API Status: <span id="fullApiStatus">Initializing...</span></p>
        </footer>
    </div>
    
    <script src="js/dashboard-api.js"></script>
    <script>
        // Dashboard configuration
        const config = {
            refreshInterval: 15000, // 15 seconds for full refresh
            metricsRefreshInterval: 3000, // 3 seconds for real-time metrics
            autoRefresh: true,
            maxActivities: 50,
            maxLogs: 100,
            apiEndpoint: 'api/dashboard-data.php'
        };
        
        // Dashboard state
        const state = {
            lastUpdateTime: new Date(),
            nextRefreshTime: new Date(Date.now() + config.refreshInterval),
            nextMetricsRefreshTime: new Date(Date.now() + config.metricsRefreshInterval),
            isRefreshing: false,
            isMetricsRefreshing: false,
            isConnected: false,
            apiLatency: 0,
            activityHistory: [],
            logHistory: [],
            currentTheme: 'dark',
            realTimeMetrics: {
                cpu: '0%',
                memory: '0%',
                disk: '0%',
                network: '0 Mbps',
                connections: 0,
                uptime: '0s'
            }
        };
        
        // API client
        const apiClient = new OpenClawDashboardAPI(config.apiEndpoint);
        
        // DOM Elements
        const elements = {
            errorMessage: document.getElementById('errorMessage'),
            systemStatusLabel: document.getElementById('systemStatusLabel'),
            apiConnectionDot: document.getElementById('apiConnectionDot'),
            apiStatusText: document.getElementById('apiStatusText'),
            systemStatus: document.getElementById('systemStatus'),
            versionValue: document.getElementById('versionValue'),
            activeSessions: document.getElementById('activeSessions'),
            tokensProcessed: document.getElementById('tokensProcessed'),
            tokensIn: document.getElementById('tokensIn'),
            tokensOut: document.getElementById('tokensOut'),
            tokensProgress: document.getElementById('tokensProgress'),
            sessionId: document.getElementById('sessionId'),
            modelUsed: document.getElementById('modelUsed'),
            contextUsage: document.getElementById('contextUsage'),
            runtimeEnv: document.getElementById('runtimeEnv'),
            thinkingMode: document.getElementById('thinkingMode'),
            gatewayStatus: document.getElementById('gatewayStatus'),
            agentsStatus: document.getElementById('agentsStatus'),
            toolsStatus: document.getElementById('toolsStatus'),
            memoryStatus: document.getElementById('memoryStatus'),
            cpuStatus: document.getElementById('cpuStatus'),
            storageStatus: document.getElementById('storageStatus'),
            healthStatus: document.getElementById('healthStatus'),
            totalRequests: document.getElementById('totalRequests'),
            avgResponse: document.getElementById('avgResponse'),
            memoryUsage: document.getElementById('memoryUsage'),
            cpuUsage: document.getElementById('cpuUsage'),
            recentActivities: document.getElementById('recentActivities'),
            activityList: document.getElementById('activityList'),
            detailedActivityList: document.getElementById('detailedActivityList'),
            logContainer: document.getElementById('logContainer'),
            activityCount: document.getElementById('activityCount'),
            detailedActivityCount: document.getElementById('detailedActivityCount'),
            logCount: document.getElementById('logCount'),
            activityCountBadge: document.getElementById('activityCountBadge'),
            lastUpdated: document.getElementById('lastUpdated'),
            currentTime: document.getElementById('currentTime'),
            nextRefresh: document.getElementById('nextRefresh'),
            refreshInterval: document.getElementById('refreshInterval'),
            fullApiStatus: document.getElementById('fullApiStatus'),
            refreshText: document.getElementById('refreshText'),
            refreshSpinner: document.getElementById('refreshSpinner'),
            floatingRefresh: document.getElementById('floatingRefresh')
        };
        
        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all buttons
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Highlight selected button
            const clickedButton = event?.target || document.getElementById(`${tabName}Btn`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
        }
        
        // Toggle auto-refresh
        function toggleAutoRefresh() {
            config.autoRefresh = !config.autoRefresh;
            const button = document.getElementById('refreshToggle');
            button.textContent = `Auto-Refresh: ${config.autoRefresh ? 'ON' : 'OFF'}`;
            button.style.background = config.autoRefresh ? 'rgba(46, 204, 113, 0.3)' : 'rgba(231, 76, 60, 0.3)';
        }
        
        // Toggle theme
        function toggleTheme() {
            state.currentTheme = state.currentTheme === 'dark' ? 'light' : 'dark';
            const button = document.getElementById('themeToggle');
            button.textContent = `Theme: ${state.currentTheme.charAt(0).toUpperCase() + state.currentTheme.slice(1)}`;
            
            if (state.currentTheme === 'light') {
                document.body.style.background = 'linear-gradient(135deg, #ffffff, #f0f0f0)';
                document.body.style.color = '#333';
            } else {
                document.body.style.background = 'linear-gradient(135deg, #1a2a6c, #2c3e50)';
                document.body.style.color = '#fff';
            }
        }
        
        // Show error message
        function showError(message) {
            elements.errorMessage.textContent = message;
            elements.errorMessage.style.display = 'block';
            
            // Hide after 5 seconds
            setTimeout(() => {
                elements.errorMessage.style.display = 'none';
            }, 5000);
        }
        
        // Update API status display
        function updateApiStatus(status, latency = null) {
            state.isConnected = status === 'connected';
            
            // Update connection indicator
            elements.apiConnectionDot.style.backgroundColor = status === 'connected' ? '#2ecc71' : '#e74c3c';
            elements.apiStatusText.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            
            // Update full status
            let statusText = `${status.toUpperCase()}`;
            if (latency !== null) {
                statusText += ` | Latency: ${latency}ms`;
                state.apiLatency = latency;
            }
            elements.fullApiStatus.textContent = statusText;
        }
        
        // Format time for display
        function formatTime(date) {
            return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second: '2-digit'});
        }
        
        // Format date time for display
        function formatDateTime(date) {
            return date.getFullYear() + '-' + 
                   String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(date.getDate()).padStart(2, '0') + ' ' +
                   String(date.getHours()).padStart(2, '0') + ':' + 
                   String(date.getMinutes()).padStart(2, '0') + ':' + 
                   String(date.getSeconds()).padStart(2, '0');
        }
        
        // Update all dashboard elements with fetched data
        async function updateDashboardWith(data) {
            try {
                // Update system status
                elements.systemStatus.textContent = data.systemStatus.status;
                elements.systemStatusLabel.textContent = data.systemStatus.status.charAt(0).toUpperCase() + data.systemStatus.status.slice(1);
                elements.versionValue.textContent = data.systemStatus.version;
                elements.activeSessions.textContent = data.sessionData.activeSessions;
                
                // Update tokens
                elements.tokensProcessed.textContent = data.tokenUsage.total.toLocaleString();
                elements.tokensIn.textContent = data.tokenUsage.in.toLocaleString();
                elements.tokensOut.textContent = data.tokenUsage.out.toLocaleString();
                elements.tokensProgress.style.width = `${data.tokenUsage.progress}%`;
                
                // Update session details
                elements.sessionId.textContent = data.sessionData.sessionId;
                elements.modelUsed.textContent = data.sessionData.model;
                elements.contextUsage.textContent = data.sessionData.contextUsage;
                elements.runtimeEnv.textContent = data.sessionData.runtime;
                elements.thinkingMode.textContent = data.sessionData.thinking;
                
                // Update system health
                elements.gatewayStatus.textContent = data.systemHealth.gateway;
                elements.agentsStatus.textContent = data.systemHealth.agents;
                elements.toolsStatus.textContent = data.systemHealth.tools;
                elements.memoryStatus.textContent = data.systemHealth.memory;
                elements.cpuStatus.textContent = data.systemHealth.cpu;
                elements.storageStatus.textContent = data.systemHealth.storage;
                
                // Update metrics
                elements.totalRequests.textContent = data.systemMetrics.totalRequests.toLocaleString();
                elements.avgResponse.textContent = data.systemMetrics.avgResponseTime;
                elements.memoryUsage.textContent = data.systemMetrics.memoryUsage;
                elements.cpuUsage.textContent = data.systemMetrics.cpuUsage;
                
                // Update activity lists
                updateActivityLists(data.recentActivities);
                
                // Update timestamps
                const now = new Date();
                document.getElementById('statusUpdated').textContent = formatTime(now);
                document.getElementById('versionUpdated').textContent = formatTime(now);
                document.getElementById('sessionsUpdated').textContent = formatTime(now);
                document.getElementById('tokensUpdated').textContent = formatTime(now);
                
                state.lastUpdateTime = now;
                
            } catch (error) {
                console.error('Error updating dashboard with data:', error);
                showError(`Error updating dashboard: ${error.message}`);
            }
        }
        
        // Update system status in real-time
        async function updateRealTimeSystemStatus() {
            try {
                const data = await apiClient.getSystemStatus();
                elements.systemStatus.textContent = data.status;
                elements.systemStatusLabel.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                
                // Update gateway status specifically
                const gatewayStatus = apiClient.checkGatewayStatus();
                elements.gatewayStatus.textContent = gatewayStatus ? 'running' : 'stopped';
                
                // Update the health status indicator
                elements.healthStatus.textContent = data.status.toUpperCase();
                elements.healthStatus.className = `system-status status-${data.status === 'operational' ? 'active' : 'inactive'}`;
                
            } catch (error) {
                console.error('Error updating real-time system status:', error);
            }
        }
        
        // Update activity lists
        function updateActivityLists(activities) {
            // Update recent activities in sidebar
            elements.recentActivities.innerHTML = '';
            activities.slice(0, 5).forEach(activity => {
                const activityItem = document.createElement('li');
                activityItem.className = 'status-item';
                
                const activityTime = new Date(activity.time);
                activityItem.innerHTML = `
                    <span>${activity.title}</span>
                    <span class="status-value">${formatTime(activityTime)}</span>
                `;
                
                elements.recentActivities.appendChild(activityItem);
            });
            
            // Update main activity lists
            updateMainActivityLists(activities);
        }
        
        // Update main activity lists
        function updateMainActivityLists(activities) {
            // Update simple activity list
            elements.activityList.innerHTML = '';
            activities.forEach(activity => {
                const activityTime = new Date(activity.time);
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                activityItem.innerHTML = `
                    <div class="activity-header">
                        <span class="activity-title">${activity.title}</span>
                        <span class="activity-time">${formatTime(activityTime)}</span>
                    </div>
                    <div class="activity-description">
                        ${activity.description}
                    </div>
                `;
                
                elements.activityList.appendChild(activityItem);
            });
            
            // Update detailed activity list
            elements.detailedActivityList.innerHTML = '';
            activities.forEach(activity => {
                const activityTime = new Date(activity.time);
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';
                
                activityItem.innerHTML = `
                    <div class="activity-header">
                        <span class="activity-title">${activity.title}</span>
                        <span class="activity-time">${formatTime(activityTime)}</span>
                    </div>
                    <div class="activity-description">
                        ${activity.description}
                    </div>
                    <div class="activity-explanation">
                        <strong>Explanation:</strong> This activity was captured from the OpenClaw system in real-time, demonstrating the live monitoring capabilities of this dashboard.
                    </div>
                `;
                
                elements.detailedActivityList.appendChild(activityItem);
            });
            
            // Update counters
            elements.activityCount.textContent = `(${activities.length})`;
            elements.detailedActivityCount.textContent = `(${activities.length})`;
            elements.activityCountBadge.textContent = `(${activities.length})`;
        }
        
        // Update log display
        function updateLogDisplay(logEntries) {
            elements.logContainer.innerHTML = '';
            
            logEntries.forEach(entry => {
                const logTime = new Date(entry.timestamp);
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                logEntry.innerHTML = `
                    <span class="log-timestamp">[${formatDateTime(logTime)}]</span>
                    <div class="log-content">
                        <span class="log-runtime">RUNTIME:</span> ${entry.description}
                        <span class="log-tokens">TOKENS:</span> IN: ${entry.inTokens}, OUT: ${entry.outTokens}
                    </div>
                `;
                
                elements.logContainer.appendChild(logEntry);
            });
            
            // Update counter
            elements.logCount.textContent = `(${logEntries.length})`;
            
            // Scroll to bottom
            elements.logContainer.scrollTop = elements.logContainer.scrollHeight;
        }
        
        // Update real-time metrics display
        function updateRealTimeMetrics(metrics) {
            elements.cpuUsage.textContent = metrics.cpu;
            elements.memoryUsage.textContent = metrics.memory;
            
            // Update system health section with real-time values
            elements.cpuStatus.textContent = metrics.cpu;
            elements.memoryStatus.textContent = metrics.memory;
            
            // Update the stats grid
            document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = metrics.memory;
            document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = metrics.cpu;
            
            // Update the detailed system health
            const diskElement = Array.from(document.querySelectorAll('.status-item span')).find(el => 
                el.textContent.includes('Storage'));
            if (diskElement) {
                diskElement.textContent = metrics.disk;
            }
            
            // Store in state for reference
            state.realTimeMetrics = metrics;
        }
        
        // Refresh real-time metrics
        async function refreshRealTimeMetrics() {
            if (state.isMetricsRefreshing) return;
            
            state.isMetricsRefreshing = true;
            
            try {
                const metrics = await apiClient.getRealTimeMetrics();
                updateRealTimeMetrics(metrics);
                
                // Update the last updated time for metrics
                document.getElementById('currentTime').textContent = new Date().toLocaleString();
                
            } catch (error) {
                console.error('Error refreshing real-time metrics:', error);
            } finally {
                state.isMetricsRefreshing = false;
            }
        }
        
        // Force refresh
        async function forceRefresh() {
            if (state.isRefreshing) return;
            
            const button = document.getElementById('forceRefreshBtn');
            const refreshText = elements.refreshText;
            const refreshSpinner = elements.refreshSpinner;
            
            state.isRefreshing = true;
            button.disabled = true;
            refreshSpinner.style.display = 'inline';
            refreshText.textContent = 'Refreshing...';
            
            try {
                // Show loading state
                elements.systemStatusLabel.textContent = 'Refreshing...';
                
                // Fetch data from API
                const startTime = Date.now();
                const data = await apiClient.getDashboardData();
                const endTime = Date.now();
                const latency = endTime - startTime;
                
                // Update API status
                updateApiStatus(data.success ? 'connected' : 'disconnected', latency);
                
                if (data.success) {
                    // Update dashboard with fetched data
                    await updateDashboardWith(data);
                    
                    // Update log display with simulated data for now
                    const simulatedLogs = generateSimulatedLogs();
                    updateLogDisplay(simulatedLogs);
                    
                    // Update footer
                    elements.currentTime.textContent = new Date().toLocaleString();
                    state.lastUpdateTime = new Date();
                    state.nextRefreshTime = new Date(Date.now() + config.refreshInterval);
                } else {
                    showError('Failed to fetch dashboard data from API');
                    updateApiStatus('error', latency);
                }
            } catch (error) {
                console.error('Refresh error:', error);
                showError(`Error refreshing dashboard: ${error.message}`);
                updateApiStatus('error');
            } finally {
                // Reset UI
                state.isRefreshing = false;
                button.disabled = false;
                refreshSpinner.style.display = 'none';
                refreshText.textContent = 'Refresh Dashboard';
                
                // Update footer
                updateFooter();
            }
        }
        
        // Refresh real-time metrics only (not full dashboard)
        async function refreshRealTimeMetrics() {
            if (state.isMetricsRefreshing) return;
            
            state.isMetricsRefreshing = true;
            
            try {
                const metrics = await apiClient.getRealTimeMetrics();
                updateRealTimeMetrics(metrics);
                
                // Update the last updated time for metrics
                elements.currentTime.textContent = new Date().toLocaleString();
                
            } catch (error) {
                console.error('Error refreshing real-time metrics:', error);
            } finally {
                state.isMetricsRefreshing = false;
            }
        }
        
        // Generate simulated logs for demonstration
        function generateSimulatedLogs() {
            const logs = [];
            const now = new Date();
            
            for (let i = 0; i < 10; i++) {
                const logTime = new Date(now.getTime() - (i * 30000)); // Every 30 seconds
                logs.push({
                    timestamp: logTime,
                    description: [
                        'Processing user request',
                        'Executing tool operation',
                        'Updating system metrics',
                        'Validating API response',
                        'Syncing with remote service',
                        'Handling authentication',
                        'Optimizing performance',
                        'Checking system health'
                    ][i % 8],
                    inTokens: Math.floor(Math.random() * 50) + 10,
                    outTokens: Math.floor(Math.random() * 30) + 5
                });
            }
            
            return logs.reverse(); // Most recent first
        }
        
        // Auto-refresh function
        function autoRefresh() {
            if (!config.autoRefresh) {
                setTimeout(autoRefresh, 1000); // Check again in 1 second
                return;
            }
            
            const now = new Date();
            
            // Check if it's time for a full refresh
            if (!state.isRefreshing && now >= state.nextRefreshTime) {
                forceRefresh();
            }
            
            // Check if it's time for real-time metrics update
            if (!state.isMetricsRefreshing && now >= state.nextMetricsRefreshTime) {
                refreshRealTimeMetrics();
                state.nextMetricsRefreshTime = new Date(Date.now() + config.metricsRefreshInterval);
            }
            
            // Update system status more frequently
            if (now.getSeconds() % 5 === 0) { // Update every 5 seconds
                updateRealTimeSystemStatus();
            }
            
            setTimeout(autoRefresh, 1000); // Check every second
        }
        
        // Update footer information
        function updateFooter() {
            elements.currentTime.textContent = new Date().toLocaleString();
            elements.refreshInterval.textContent = Math.floor(config.refreshInterval / 1000);
            
            if (config.autoRefresh) {
                elements.nextRefresh.textContent = formatTime(state.nextRefreshTime);
            } else {
                elements.nextRefresh.textContent = 'Manual only';
            }
        }
        
        // Initialize the dashboard
        async function initDashboard() {
            console.log("Initializing real-time dashboard with live API connection...");
            
            // Set initial API status
            updateApiStatus('connecting');
            
            // Initial data load
            await forceRefresh();
            
            // Start auto-refresh monitoring
            autoRefresh();
            
            // Update footer initially
            updateFooter();
            
            // Set up periodic footer updates
            setInterval(updateFooter, 1000);
            
            // Update refresh interval display
            document.getElementById('refreshInterval').textContent = Math.floor(config.refreshInterval / 1000);
        }
        
        // Start the dashboard when the page loads
        window.onload = initDashboard;
        
        // Expose functions for debugging/console access
        window.dashboard = {
            config: config,
            state: state,
            apiClient: apiClient,
            refresh: forceRefresh,
            toggleAutoRefresh: toggleAutoRefresh,
            toggleTheme: toggleTheme,
            showError: showError
        };
    </script>
</body>
</html>